import{f as T,o as H,j as e,a as C,p as I,q as Z,r as l,s as ee,S as se,B as re,V as te}from"./index-BgPfMftx.js";import{c as ae,b as $,a as g,d as z,u as oe,H as ne,o as ie}from"./index.esm-F5rMhw4R.js";import{u as le,b as ce}from"./JwtTokenRotate-Du0PIfFb.js";import{useCapslock as de}from"./CheckCapslock-B2pc3eFJ.js";import{a as ue,W as me}from"./chunk-7ELO524Q-BClZfhVC.js";import{u as V,b as pe,c as he,F as S,I as R}from"./chunk-6CVSDS6C-qNJvPn8p.js";import{u as fe,b as xe}from"./chunk-DMO4EI7P-ffbJSNvT.js";import{u as ye}from"./chunk-6RSEZNRH-DJ-mtPeE.js";import{B as je}from"./chunk-UVUR7MCU-XGr7ouz6.js";import"./index-VWaDGczM.js";import"./axios-B4uVmeYG.js";import"./index-CxF79Cv8.js";import"./chunk-3Y4YXCR2-D1_PzN3D.js";import"./chunk-2GBDXOMA-DT3Pegqs.js";import"./chunk-5PH6ULNP-DzDKoMfl.js";import"./index-Bgli6ANI.js";var W=T(function(t,a){var s;const r=fe("FormLabel",t),i=H(t),{className:k,children:u,requiredIndicator:v=e.jsx(J,{}),optionalIndicator:h=null,...f}=i,m=V(),x=(s=m==null?void 0:m.getLabelProps(f,a))!=null?s:{ref:a,...f};return e.jsxs(C.label,{...x,className:I("chakra-form__label",i.className),__css:{display:"block",textAlign:"start",...r},children:[u,m!=null&&m.isRequired?v:h]})});W.displayName="FormLabel";var J=T(function(t,a){const s=V(),r=pe();if(!(s!=null&&s.isRequired))return null;const i=I("chakra-form__required-indicator",t.className);return e.jsx(C.span,{...s==null?void 0:s.getRequiredIndicatorProps(t,a),__css:r.requiredIndicator,className:i})});J.displayName="RequiredIndicator";var M=T(function(t,a){const{children:s,placeholder:r,className:i,...k}=t;return e.jsxs(C.select,{...k,ref:a,className:I("chakra-select",i),children:[r&&e.jsx("option",{value:"",children:r}),s]})});M.displayName="SelectField";function ve(n,t){const a={},s={};for(const[r,i]of Object.entries(n))t.includes(r)?a[r]=i:s[r]=i;return[a,s]}var U=T((n,t)=>{var a;const s=xe("Select",n),{rootProps:r,placeholder:i,icon:k,color:u,height:v,h,minH:f,minHeight:m,iconColor:x,iconSize:y,...b}=H(n),[j,q]=ve(b,ee),d=he(q),F={width:"100%",height:"fit-content",position:"relative",color:u},w={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(a=s.field)==null?void 0:a._focus}};return e.jsxs(C.div,{className:"chakra-select__wrapper",__css:F,...j,...r,children:[e.jsx(M,{ref:t,height:h??v,minH:f??m,placeholder:i,...d,__css:w,children:n.children}),e.jsx(X,{"data-disabled":Z(d.disabled),...(x||u)&&{color:x||u},__css:s.icon,...y&&{fontSize:y},children:k})]})});U.displayName="Select";var be=n=>e.jsx("svg",{viewBox:"0 0 24 24",...n,children:e.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),ge=C("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),X=n=>{const{children:t=e.jsx(be,{}),...a}=n,s=l.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return e.jsx(ge,{...a,className:"chakra-select__icon-wrapper",children:l.isValidElement(t)?s:null})};X.displayName="SelectIcon";const Oe=()=>{const n=l.useMemo(()=>ae().shape(localStorage.getItem("accessToken")?{numberOfPeople:$().typeError("人數必須是數字").min(1,"至少一人").max(20,"最多20人").required("人數是必填項"),resTime:g().required("Reservation time is required"),resDate:z().typeError("請輸入有效日期").required("日期是必填項"),occasion:g().oneOf(["Birthday","Anniversary"],"必須是 Birthday 或 Anniversary").required("場合是必填項")}:{fname:g().required("First name is required"),email:g().email("請輸入有效的電子郵件地址").required("電子郵件是必填項"),numberOfPeople:$().typeError("人數必須是數字").min(1,"至少一人").max(20,"最多20人").required("人數是必填項"),resTime:g().required("Reservation time is required"),resDate:z().typeError("請輸入有效日期").required("日期是必填項"),occasion:g().oneOf(["Birthday","Anniversary"],"必須是 Birthday 或 Anniversary").required("場合是必填項")}),[]),{register:t,handleSubmit:a,watch:s,formState:{errors:r,isValid:i},setValue:k}=oe({mode:"onChange",resolver:ie(n)}),{fname:u,email:v,availableAccessToken:h,isEmail:f,accessToken:m}=le(),x=ye(),y=s("fname"),b=s("email"),j=s("numberOfPeople"),q=s("resTime"),d=s("resDate"),F=s("occasion"),w=l.useCallback(async o=>{let p=ce.get("X-CSRF-Token");try{await(await fetch("http://localhost:5000/reservation/reservation",{method:"post",body:JSON.stringify(h?{fname:u,email:v,numberOfPeople:j,resTime:q,resDate:d,occasion:F}:{fname:y,email:b,numberOfPeople:j,resTime:q,resDate:d,occasion:F}),credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`,"X-CSRF-Token":`${p}`}})).json()&&(x({title:"Reserve Successfully",status:"success",duration:2e3}),setTimeout(()=>{window.location.href="./"},2e3))}catch(c){console.error("Error:",c)}},[h,u,v,j,q,d,F,y,b,x]),Y=de(),P=l.useRef(),B=l.useRef(),A=l.useRef();l.useEffect(()=>{const o=setTimeout(()=>{const p=[P,B,A],c=[y,b,j];p.forEach((N,L)=>{N.current&&N.current.value!==c[L]&&(N.current.value=c[L])})},100);return()=>clearTimeout(o)},[y,b,j]);const[_,D]=l.useState(),E=l.useCallback(async o=>{if(!o||isNaN(Date.parse(o))){D(!1);return}const c=await(await fetch(`http://localhost:5000/reservation/checkReservation?resDate=${o}`)).json();D(c)},[]);l.useEffect(()=>{d&&E(d)},[d,E]);const[G,O]=l.useState("text"),K=()=>{O("date")},Q=()=>{O("text")};return e.jsxs(se,{direction:"column",marginBottom:"2",justifyContent:"center",alignItems:"center",children:[e.jsx(ne,{color:"#F4CE14",children:"Reserve Now!"}),e.jsx(re,{bg:"white",padding:10,rounded:"md",height:"auto",minW:{base:"90%",md:"468px"},fontSize:{base:"1.5em",lg:"2em"},children:e.jsx("form",{onSubmit:a(w),children:e.jsxs(te,{spacing:4,align:"flex-start",children:[!f&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx(R,{name:"fname",ref:P,...t("fname"),placeholder:"First Name"}),r.fname&&e.jsx("p",{children:r.fname.message})]}),e.jsxs(S,{children:[e.jsx(R,{name:"email",ref:B,...t("email"),placeholder:"Email"}),r.email&&e.jsx("p",{children:r.email.message})]})]}),e.jsxs(S,{children:[e.jsx(R,{type:"number",name:"numberOfPeople",ref:A,...t("numberOfPeople"),placeholder:"Number of People"}),r.numberOfPeople&&e.jsx("p",{children:r.numberOfPeople.message})]}),e.jsxs(S,{children:[e.jsx(R,{type:G,name:"resDate",...t("resDate"),placeholder:"Choose Date",onFocus:K,onBlur:o=>{Q(),E(o.target.value)}}),r.resDate&&e.jsx("p",{children:r.resDate.message})]}),e.jsxs(S,{children:[_?e.jsx(ue,{width:"100%",justify:"space-around",children:_.map(({time:o,isOrder:p})=>{var c;return e.jsxs(me,{children:[e.jsx(R,{type:"radio",id:o,name:"resTime",disabled:!p,display:"none",...t("resTime"),value:o}),e.jsx(W,{width:"100%",htmlFor:o,style:{background:p?"#F4CE14":"#eee",cursor:p?"pointer":"not-allowed",borderRadius:"10px",textAlign:"center",margin:0,border:(c=document.getElementById(o))!=null&&c.checked?"2px solid #495E57":"none"},children:o})]},o)})}):null,r.resTime&&e.jsx("span",{children:"This field is required"})]}),e.jsxs(S,{children:[e.jsxs(U,{id:"occasion",...t("occasion",{required:!0}),children:[e.jsx("option",{value:"",children:"--Occasion--"}),e.jsx("option",{value:"Birthday",children:"Birthday"}),e.jsx("option",{value:"Anniversary",children:"Anniversary"})]}),r.occasion&&e.jsx("span",{children:"This field is required"})]}),Y?e.jsx("p",{children:"Caps Lock is active!"}):null,e.jsx(je,{type:"submit",width:"100%",backgroundColor:i&&_?"#F4CE14":"lightgrey",isDisabled:!(i&&_),children:"Order!"})]})})})]})};export{Oe as default};
