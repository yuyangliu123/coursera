import{f as H,j as e,a as E,r as f,S as w,H as L,B as D}from"./index-BgPfMftx.js";import{c as q,a as S,e as G,u as U,H as C,o as $}from"./index.esm-F5rMhw4R.js";import{useCapslock as _}from"./CheckCapslock-B2pc3eFJ.js";import{j as z}from"./index-VWaDGczM.js";import{a as b}from"./axios-B4uVmeYG.js";import{L as P,C as A}from"./chunk-K7XRJ7NL-Bu74VLaG.js";import{T as N}from"./chunk-2OOHT3W5-CJpRdX3-.js";import{u as O}from"./chunk-6RSEZNRH-DJ-mtPeE.js";import{B as x}from"./chunk-UVUR7MCU-XGr7ouz6.js";import{F as W,I as v}from"./chunk-6CVSDS6C-qNJvPn8p.js";import{I as F}from"./chunk-FKYN3ZGE-B3QWMpSL.js";import"./chunk-DMO4EI7P-ffbJSNvT.js";import"./index-CxF79Cv8.js";import"./index-Bgli6ANI.js";import"./chunk-3Y4YXCR2-D1_PzN3D.js";import"./chunk-2GBDXOMA-DT3Pegqs.js";import"./chunk-5PH6ULNP-DzDKoMfl.js";import"./chunk-R3DH46PF-iWUMGBws.js";var j=H(function(n,t){const{direction:c,align:m,justify:u,wrap:l,basis:p,grow:d,shrink:r,...g}=n,k={display:"flex",flexDirection:c,alignItems:m,justifyContent:u,flexWrap:l,flexBasis:p,flexGrow:d,flexShrink:r};return e.jsx(E.div,{ref:t,__css:k,...g})});j.displayName="Flex";const V=q().shape({password:S().min(8,"At least 8 words").required("Password is required"),confirm:S().oneOf([G("password"),null],"Passwords must match").required("Confirm your password")}),me=()=>{const[a,n]=f.useState({email:"",updated:!1,isLoading:!1,error:!1});f.useEffect(()=>{(async()=>{const T=new URLSearchParams(window.location.search).get("token"),y=z(T);try{let i=await b.post("http://localhost:5000/forgotpassword/checkvalidate",{email:y.email,token:y.token});i.status===400?n(h=>({...h,updated:!0,error:!0})):i.status===200&&n(h=>({...h,updated:!0,email:i.data.email}))}catch(i){console.error("Error:",i)}})()},[]);const[t,c]=f.useState(!1),m=()=>c(!t),u=_(),{register:l,handleSubmit:p,watch:d,formState:{errors:r,isValid:g},reset:k}=U({mode:"onSubmit",resolver:$(V)}),I=d("password");d("confirm");const o=O(),R=async B=>{try{let s=await b.post("http://localhost:5000/forgotpassword/reset",{email:a.email,password:I});s&&(s.status===200?(o({title:"Change password success",description:"You will soon be redirected",status:"success",duration:2e3}),setTimeout(()=>{window.location.href="/loginrotate"},2e3)):s.status===402?o({title:"User does not exist",description:"Something Went Wrong",status:"error",duration:3e3}):s.status===401?o({title:"The new password is the same as the old password.",description:"Please use another password",status:"error",duration:3e3}):s.status===400&&o({title:"Something Went Wrong",status:"error",duration:3e3}))}catch(s){s.response&&(s.response.status===400?o({title:"Something Went Wrong",status:"error",duration:3e3}):s.response.status===401?o({title:"The new password is the same as the old password.",description:"Please use another password",status:"error",duration:3e3}):s.response.status===402&&o({title:"User does not exist",description:"Something Went Wrong",status:"error",duration:3e3}))}};if(a.updated===!0){if(a.error===!0)return e.jsx(j,{flexDirection:"column",width:"100wh",height:"100vh",backgroundColor:"gray.200",justifyContent:"center",alignItems:"center",children:e.jsxs(w,{direction:"column",marginBottom:"2",justifyContent:"center",alignItems:"center",children:[e.jsx(C,{color:"teal.400",children:"Problem resetting password"}),e.jsx("p",{children:"Reset link expire or invalid link"}),e.jsx("p",{children:"Please send another reset link"}),e.jsxs(L,{children:[e.jsx(x,{children:e.jsx(P,{href:"/",children:"Go Home"})}),e.jsx(x,{children:e.jsx(P,{href:"/forgotpassword",children:"Forgot Password"})})]})]})});if(a.email)return e.jsx(j,{flexDirection:"column",width:"100wh",height:"100vh",backgroundColor:"gray.200",justifyContent:"center",alignItems:"center",children:e.jsxs(w,{direction:"column",marginBottom:"2",justifyContent:"center",alignItems:"center",children:[e.jsx(C,{color:"teal.400",children:"Reset your password"}),e.jsxs(N,{color:"teal.400",children:["Enter your email address and weâ€™ll",e.jsx("br",{}),"send you a link to reset your password"]}),e.jsx(D,{minW:{base:"90%",md:"468px"},children:e.jsx("form",{onSubmit:p(R),children:e.jsxs(w,{spacing:4,p:"1rem",backgroundColor:"white",boxShadow:"md",children:[e.jsx(W,{children:e.jsx(F,{children:e.jsx(v,{type:t?"text":"password",placeholder:"Password",...l("password")})})}),e.jsx(W,{children:e.jsx(F,{children:e.jsx(v,{type:t?"text":"password",placeholder:"Confirm Password",...l("confirm")})})}),r.password&&e.jsx("p",{children:r.password.message}),!r.password&&r.confirm&&e.jsx("p",{children:r.confirm.message}),u?e.jsx("p",{children:"Caps Lock is active!"}):null,e.jsx(A,{size:"sm",isChecked:t,onChange:m,children:t?"Hide Password":"Show Password"}),e.jsx(x,{borderRadius:0,type:"submit",variant:"solid",colorScheme:"teal",width:"full",children:"Submit"})]})})})]})})}};export{me as default};
