import{r as S,j as a,B as p,S as U,V as P,L as Q,H as E}from"./index-BgPfMftx.js";import{u as q}from"./JwtTokenRotate-Du0PIfFb.js";import{r as j,_ as T,m as H,J as O,C as L,M as Y}from"./ApolloContext-ovhTzdFd.js";import{F as z}from"./index.es-lcVZeYJ_.js";import{a as N}from"./index-2nK-IdFL.js";import{a as V,v as J,D as K,g as F,b as G,o as W}from"./index-vNCPerwW.js";import{I as R}from"./chunk-QINAG4RG-CS9ezQ7p.js";import{T as I}from"./chunk-2OOHT3W5-CJpRdX3-.js";import{B as _}from"./chunk-UVUR7MCU-XGr7ouz6.js";import"./index-VWaDGczM.js";import"./axios-B4uVmeYG.js";import"./index-Bgli6ANI.js";import"./chunk-DMO4EI7P-ffbJSNvT.js";import"./chunk-R3DH46PF-iWUMGBws.js";import"./index-CxF79Cv8.js";import"./chunk-5PH6ULNP-DzDKoMfl.js";function X(l,o){var u=V(o==null?void 0:o.client);J(l,K.Mutation);var x=j.useState({called:!1,loading:!1,client:u}),g=x[0],m=x[1],e=j.useRef({result:g,mutationId:0,isMounted:!0,client:u,mutation:l,options:o});Object.assign(e.current,{client:u,options:o,mutation:l});var w=j.useCallback(function(n){n===void 0&&(n={});var M=e.current,k=M.options,t=M.mutation,h=T(T({},k),{mutation:t}),s=n.client||e.current.client;!e.current.result.loading&&!h.ignoreResults&&e.current.isMounted&&m(e.current.result={loading:!0,error:void 0,data:void 0,called:!0,client:s});var y=++e.current.mutationId,r=H(h,n);return s.mutate(r).then(function(i){var c,f,b=i.data,v=i.errors,d=v&&v.length>0?new O({graphQLErrors:v}):void 0,$=n.onError||((c=e.current.options)===null||c===void 0?void 0:c.onError);if(d&&$&&$(d,r),y===e.current.mutationId&&!r.ignoreResults){var B={called:!0,loading:!1,data:b,error:d,client:s};e.current.isMounted&&!L(e.current.result,B)&&m(e.current.result=B)}var A=n.onCompleted||((f=e.current.options)===null||f===void 0?void 0:f.onCompleted);return d||A==null||A(i.data,r),i}).catch(function(i){var c;if(y===e.current.mutationId&&e.current.isMounted){var f={loading:!1,error:i,data:void 0,called:!0,client:s};L(e.current.result,f)||m(e.current.result=f)}var b=n.onError||((c=e.current.options)===null||c===void 0?void 0:c.onError);if(b)return b(i,r),{data:void 0,errors:i};throw i})},[]),C=j.useCallback(function(){if(e.current.isMounted){var n={called:!1,loading:!1,client:u};Object.assign(e.current,{mutationId:0,result:n}),m(n)}},[]);return j.useEffect(function(){return e.current.isMounted=!0,function(){e.current.isMounted=!1}},[]),[w,T({reset:C},g)]}const Z=F`
query Likeitemlist($email: String) {
  likeitemlist(email: $email) {
    likeItem {
      idMeal
      strMeal
      baseAmount
      strMealThumb
    }
  }
}
`,tt=F`
mutation Updatelikelist($email: String, $idMeal: String, $baseAmount: Float, $state: String) {
  updatelikelist(email: $email, idMeal: $idMeal, baseAmount:$baseAmount, state: $state) {
    likeItem {
      strMeal
      idMeal
      baseAmount
      strMealThumb
    }
  }
}
`,D=async()=>await W("meal-database",1,{upgrade(o){o.objectStoreNames.contains("cart")||o.createObjectStore("cart",{keyPath:"idMeal"})}}),et=async l=>{const u=(await D()).transaction("cart","readwrite");await u.objectStore("cart").put(l),await u.done},vt=()=>{const{email:l,isEmail:o}=q(),{cartItem:u,setCartItem:x}=S.useContext(Y),[g,m]=S.useState(null),{data:e,loading:w,error:C,refetch:n}=G(Z,{variables:{email:l},fetchPolicy:"network-only",skip:!l||!o,onCompleted:t=>{m(t.likeitemlist[0])},onError:t=>{console.log(t)}}),[M]=X(tt,{onCompleted:()=>{n().then(t=>{m(t.data.likeitemlist[0])})}}),k=async({state:t,baseAmount:h,idMeal:s})=>{let r=await(await D()).get("cart","cartData");if(r){if(t==="addtocart"){const i=r.likeItem.find(d=>d.idMeal===s);console.log({item:i,a:i.baseAmount});const c=r.data.find(d=>d.idMeal===s),f={numMeal:1},b={cartAmount:i.baseAmount},v=Object.assign(i,f,b);v&&(c?c&&(c.numMeal+=1):r.data.push(v),r.totalItem+=1,r.totalAmount+=h,r.totalAmount=parseFloat(r.totalAmount.toFixed(2)),r.likeItem=r.likeItem.filter(d=>d.idMeal!==s))}else t==="delete"&&(r.likeItem=r.likeItem.filter(i=>i.idMeal!==s));await et(Object.assign(r,{idMeal:"cartData"}))}};return S.useEffect(()=>{o||(async()=>{let s=await(await D()).get("cart","cartData");s&&m(s)})()},[o,g]),w?a.jsx(p,{children:"Loading..."}):C?a.jsx(p,{children:"Error Occurred"}):!g||g.likeItem==""?a.jsx(p,{width:"100%",children:a.jsx(p,{textStyle:"StyledH2",color:"#000000",margin:"0 auto",width:"fit-content",children:"No Like Item In Your List"})}):a.jsx(U,{direction:{xxl:"row",base:"column"},width:"100%",alignItems:"flex-start",spacing:6,children:a.jsx(p,{width:"100%",display:"grid",gridTemplateColumns:{xl:"repeat(4, 1fr)",lg:"repeat(3, 1fr)",md:"repeat(2, 1fr)",base:"repeat(1, 1fr)"},gap:"10px",height:"fit-content",children:g.likeItem.map((t,h)=>a.jsxs(P,{width:"100%",border:".063rem solid #e4e4e4",paddingBottom:"1rem",marginBottom:"3.125rem",height:"auto",_hover:{img:{opacity:.7},p:{color:"#da1a32"}},children:[a.jsxs(Q,{to:`/order2/${t.strMeal}`,children:[a.jsx(R,{src:t.strMealThumb,alt:t.strMeal,width:"auto",height:"auto",objectFit:"cover"}),a.jsxs(p,{padding:"1.25rem 1rem .75rem",children:[a.jsx(I,{textStyle:"StyledText",color:"#333333",align:"center",marginBottom:"0.625rem",children:t.strMeal}),a.jsx(p,{children:a.jsxs(I,{textStyle:"StyledText",color:"#333333",align:"end",marginRight:"1rem",children:["Price: $",t.baseAmount]})})]})]}),a.jsxs(E,{justifyContent:"right",children:[a.jsx(_,{backgroundColor:"#e5e5e5",size:"md",onClick:async()=>{o?await M({variables:{email:l,idMeal:t.idMeal,baseAmount:t.baseAmount,state:"addtocart"}}):k({idMeal:t.idMeal,baseAmount:t.baseAmount,state:"addtocart"}),await x(u+1)},children:a.jsxs(E,{justifyContent:"space-between",width:"100%",children:[a.jsx(R,{src:"/images/Basket.svg",height:"30px"}),a.jsx(I,{children:"Add to cart"})]})}),a.jsx(_,{backgroundColor:"#e5e5e5",size:"md",onClick:async()=>{o?M({variables:{email:l,idMeal:t.idMeal,state:"delete"}}):k({idMeal:t.idMeal,state:"delete"})},children:a.jsxs(E,{justifyContent:"space-between",width:"100%",children:[a.jsx(z,{icon:N}),a.jsx(I,{children:"Remove"})]})})]})]},t.idMeal))})})};export{vt as default};
