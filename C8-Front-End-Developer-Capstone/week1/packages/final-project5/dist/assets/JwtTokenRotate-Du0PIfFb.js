import{r as d,j as h}from"./index-BgPfMftx.js";import{j as k}from"./index-VWaDGczM.js";import{a as R}from"./axios-B4uVmeYG.js";let m;const w=new Uint8Array(16);function S(){if(!m&&(m=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!m))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(w)}const s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));function I(e,n=0){return s[e[n+0]]+s[e[n+1]]+s[e[n+2]]+s[e[n+3]]+"-"+s[e[n+4]]+s[e[n+5]]+"-"+s[e[n+6]]+s[e[n+7]]+"-"+s[e[n+8]]+s[e[n+9]]+"-"+s[e[n+10]]+s[e[n+11]]+s[e[n+12]]+s[e[n+13]]+s[e[n+14]]+s[e[n+15]]}const j=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),v={randomUUID:j};function x(e,n,a){if(v.randomUUID&&!n&&!e)return v.randomUUID();e=e||{};const r=e.random||(e.rng||S)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,I(r)}/*! js-cookie v3.0.5 | MIT */function f(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var r in a)e[r]=a[r]}return e}var D={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function T(e,n){function a(t,c,o){if(!(typeof document>"u")){o=f({},n,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var u="";for(var i in o)o[i]&&(u+="; "+i,o[i]!==!0&&(u+="="+o[i].split(";")[0]));return document.cookie=t+"="+e.write(c,t)+u}}function r(t){if(!(typeof document>"u"||arguments.length&&!t)){for(var c=document.cookie?document.cookie.split("; "):[],o={},u=0;u<c.length;u++){var i=c[u].split("="),l=i.slice(1).join("=");try{var p=decodeURIComponent(i[0]);if(o[p]=e.read(l,p),t===p)break}catch{}}return t?o[t]:o}}return Object.create({set:a,get:r,remove:function(t,c){a(t,"",f({},c,{expires:-1}))},withAttributes:function(t){return T(this.converter,f({},this.attributes,t))},withConverter:function(t){return T(f({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(e)}})}var g=T(D,{path:"/"});const C=async e=>{try{const n=await U(e).post("http://localhost:5000/login2/check-refresh-token");if(n.status===200){const a=n.data.accessToken;localStorage.setItem("accessToken",a);const r=x();return g.set("X-CSRF-Token",r,{secure:!0,sameSite:"strict"}),a}}catch(n){if(n.response&&(n.response.status===400||n.response.status===401))return console.log(n.response.data),localStorage.removeItem("accessToken"),g.remove("X-CSRF-Token"),null}},U=e=>{let n=g.get("X-CSRF-Token");return n||(n=x(),g.set("X-CSRF-Token",n,{secure:!0,sameSite:"strict"})),R.create({baseURL:"http://localhost:5000",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,"X-CSRF-Token":`${n}`},withCredentials:!0})},b=async()=>{var n;let e=localStorage.getItem("accessToken");return((n=k(e))==null?void 0:n.exp)<Date.now()/1e3&&(e=await C(e)),U(e)},A=d.createContext(),y=d.createContext(),V=()=>d.useContext(y),z=({children:e})=>{const[n,a]=d.useState({}),r=localStorage.getItem("accessToken");return d.useEffect(()=>{(async()=>{const t=localStorage.getItem("accessToken");if(t){const c=t?k(t):null,o=Date.now()/1e3,u=(c==null?void 0:c.exp)>o;if(u){const i={availableAccessToken:u,accessToken:t,isUser:!0,fname:c.fname,lname:c.lname,email:c.email};a(i)}else if(!u){console.log("at expire");const i=await C(t);if(i){console.log(i);const l=k(i),p={availableAccessToken:!0,accessToken:t,isUser:!0,fname:l.fname,lname:l.lname,email:l.email};a(p)}}}else a({availableAccessToken:null,accessToken:null,isUser:!1,fname:null,lname:null,email:null})})()},[r]),h.jsx(A.Provider,{value:n,children:h.jsx(y.Provider,{value:n,children:e})})};export{z as T,b as a,g as b,V as u,x as v};
