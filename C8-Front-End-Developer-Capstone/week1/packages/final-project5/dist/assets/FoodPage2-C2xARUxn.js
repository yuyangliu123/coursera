import{r as n,y as T,j as s,V as j,S as B,H as E,B as p}from"./index-BgPfMftx.js";import{M as F}from"./ApolloContext-ovhTzdFd.js";import{u as O,a as I}from"./JwtTokenRotate-Du0PIfFb.js";import{F as P}from"./index.es-lcVZeYJ_.js";import{f as U}from"./index-2nK-IdFL.js";import{a as v}from"./index-Ti5CdbK3.js";import{g as H,b as R,o as _}from"./index-vNCPerwW.js";import{S as x}from"./chunk-GOJLRND4-Cwyv9KoW.js";import{B as k}from"./chunk-UVUR7MCU-XGr7ouz6.js";import"./index-VWaDGczM.js";import"./axios-B4uVmeYG.js";import"./chunk-DMO4EI7P-ffbJSNvT.js";import"./chunk-5PH6ULNP-DzDKoMfl.js";import"./index-CxF79Cv8.js";const $=H`
query Likeitemnumber($email: String!) {
  likeitemnumber(email: $email) {
    likeItem {
      strMeal
    }
  }
}
`,M=async()=>await _("meal-database",1,{upgrade(u){u.objectStoreNames.contains("cart")||u.createObjectStore("cart",{keyPath:"idMeal"})}}),y=async e=>{const h=(await M()).transaction("cart","readwrite");await h.objectStore("cart").put(e),await h.done},nt=()=>{const[e,u]=n.useState(),{strMeal:h}=T(),c=decodeURIComponent(h),[r,q]=n.useState(1),[d,S]=n.useState(),{cartItem:z,setCartItem:b}=n.useContext(F),{email:w,isUser:m,accessToken:N}=O(),[g,f]=n.useState(!1),{loading:Q,error:V,data:K,refetch:D}=R($,{variables:{email:w},fetchPolicy:"network-only",skip:!w,onCompleted:a=>{const i=a.likeitemnumber.flatMap(t=>t.likeItem).some(t=>t.strMeal===c);f(i)},onError:a=>{console.log(a)}});n.useEffect(()=>{m||(async()=>{let i=await(await M()).get("cart","cartData");if(i&&i.likeItem){const t=i.likeItem.some(l=>l.strMeal===c);f(t)}})()},[c,m]),n.useEffect(()=>{(async()=>c&&await fetch(`http://localhost:5000/api/foodPage/${c}`).then(a=>a.json()).then(a=>{u(o=>({...o,...a})),S(a.price)}).catch(a=>console.log(a)))()},[h]);const C=async()=>{const a=!g,o={strMeal:e.strMeal,idMeal:e.idMeal,baseAmount:e.price,strMealThumb:e.strMealThumb,_id:e.idMeal};if(!m){console.log("User is not logged in. Saving order locally.");let t=await(await M()).get("cart","cartData");t?a===!0?t.likeItem.push(o):t.likeItem=t.likeItem.filter(l=>l.idMeal!==o.idMeal):t={isUser:m,totalAmount:d,totalItem:r,data:[],likeItem:[o]},await y(Object.assign(t,{idMeal:"cartData"})),f(a);return}try{(await(await I()).post("http://localhost:5000/api/update",{event:"like",likeState:a?"like":"none",meal:e.strMeal,idMeal:e.idMeal,price:e.price,strMealThumb:e.strMealThumb})).status===200&&(f(a),D())}catch(i){console.log(i)}},A=async()=>{const a={meal:e.strMeal,numMeal:r,idMeal:e.idMeal,price:d,strMealThumb:e.strMealThumb},o={strMeal:e.strMeal,numMeal:r,idMeal:e.idMeal,baseAmount:e.price,cartAmount:d,strMealThumb:e.strMealThumb,_id:e.idMeal};if(m)try{(await(await I()).post("http://localhost:5000/api/addToCart",a)).status===200&&b(t=>t+r)}catch(i){console.log(i)}else{console.log("User is not logged in. Saving order locally.");let t=await(await M()).get("cart","cartData");if(t){t.totalAmount+=d,t.totalAmount=parseFloat(t.totalAmount.toFixed(2)),t.totalItem+=r;const l=t.data.findIndex(L=>L.idMeal===o.idMeal);l!==-1?(t.data[l].numMeal+=r,t.data[l].cartAmount+=d):t.data.push(o)}else t={isUser:m,totalAmount:d,totalItem:r,data:[o],likeItem:[]};await y(Object.assign(t,{idMeal:"cartData"})),b(l=>l+r);return}};return s.jsx(s.Fragment,{children:s.jsx(j,{w:"100%",align:"start",padding:"100px 0",id:"menu",children:s.jsxs(B,{w:"100%",justifyContent:{base:"none",lg:"space-between"},marginBottom:"50px",direction:{base:"column",lg:"row"},children:[s.jsxs(j,{width:{base:"100%",lg:"50%"},children:[s.jsx(x,{width:"50%",height:"30px"}),s.jsx(x,{width:"100%",height:"600px"}),s.jsxs(E,{width:{md:"50%",base:"80%"},children:[s.jsx(k,{children:"-"}),s.jsx(p,{children:r}),s.jsx(k,{children:"+"}),s.jsx(p,{width:"100%",children:s.jsx(x,{width:"100%",height:"24px"})}),s.jsx(k,{onClick:()=>A(),children:"Order!"}),s.jsx(P,{icon:g?v:U,size:"xl",style:{color:"#ff0000",transition:"transform 0.3s ease-in-out",transform:g?"scale(1.3)":"scale(1)"},onClick:()=>{C()}})]})]}),s.jsxs(p,{width:{base:"100%",lg:"40%"},children:[s.jsx(p,{as:"h3",fontSize:"3em",children:"Description"}),s.jsx(p,{children:[...Array(10)].map((a,o)=>s.jsx(x,{width:"100%",height:"24px",margin:"1%"}))})]})]})})})};export{nt as default};
