import{f as k,o as G,h as X,j as e,a as U,B as n,V as R,L as J,H as K,t as Z,r as u}from"./index-BgPfMftx.js";import{H as O}from"./react-router-hash-link.esm-t3Hb1-yz.js";import"./index-VWaDGczM.js";import{u as Q,a as ee,b as B}from"./JwtTokenRotate-Du0PIfFb.js";import{r as S,m as F,_ as p,M as te}from"./ApolloContext-ovhTzdFd.js";import"./apollo-client-D2HdrQhP.js";import{S as re}from"./chunk-YJYDBQZ3-DQH71ZyI.js";import{I as se}from"./imageConvert-EpfzBV9D.js";import{B as A}from"./chunk-UVUR7MCU-XGr7ouz6.js";import{D as oe}from"./chunk-W7WUSNWJ-eHADBn8h.js";import{F as ae}from"./index.es-lcVZeYJ_.js";import{u as ne,a as ie,g as $,b as le,o as ce}from"./index-vNCPerwW.js";import{u as z}from"./useClickOutside-CuiuMGrl.js";import{I as w}from"./chunk-QINAG4RG-CS9ezQ7p.js";import{a as de}from"./index-Ti5CdbK3.js";import{M as H}from"./ModalContext-C2Fbkkgf.js";import{G as q}from"./GlobalModalContext-CEanKhtL.js";import{u as ue}from"./chunk-6RSEZNRH-DJ-mtPeE.js";import{I as me}from"./chunk-2GBDXOMA-DT3Pegqs.js";import{c as he}from"./index-CxF79Cv8.js";import{b as fe}from"./chunk-DMO4EI7P-ffbJSNvT.js";import{T as N}from"./chunk-2OOHT3W5-CJpRdX3-.js";var[xe,Y]=he({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),I=k(function(t,o){const s=fe("List",t),{children:a,styleType:f="none",stylePosition:l,spacing:x,...h}=G(t),c=X(a),m=x?{["& > *:not(style) ~ *:not(style)"]:{mt:x}}:{};return e.jsx(xe,{value:s,children:e.jsx(U.ul,{ref:o,listStyleType:f,listStylePosition:l,role:"list",__css:{...s.container,...m},...h,children:c})})});I.displayName="List";var ge=k((r,t)=>{const{as:o,...s}=r;return e.jsx(I,{ref:t,as:"ol",styleType:"decimal",marginStart:"1em",...s})});ge.displayName="OrderedList";var pe=k(function(t,o){const{as:s,...a}=t;return e.jsx(I,{ref:o,as:"ul",styleType:"initial",marginStart:"1em",...a})});pe.displayName="UnorderedList";var V=k(function(t,o){const s=Y();return e.jsx(U.li,{ref:o,...t,__css:s.item})});V.displayName="ListItem";var ye=k(function(t,o){const s=Y();return e.jsx(me,{ref:o,role:"presentation",...t,__css:s.icon})});ye.displayName="ListIcon";var je=["refetch","reobserve","fetchMore","updateQuery","startPolling","subscribeToMore"];function ve(r,t){var o,s=S.useRef(),a=S.useRef(),f=S.useRef(),l=F(t,s.current||{}),x=(o=l==null?void 0:l.query)!==null&&o!==void 0?o:r;a.current=t,f.current=x;var h=ne(ie(t&&t.client),x),c=h.useQuery(p(p({},l),{skip:!s.current})),y=c.observable.options.initialFetchPolicy||h.getDefaultFetchPolicy(),m=Object.assign(c,{called:!!s.current}),g=S.useMemo(function(){for(var i={},v=function(L){var T=m[L];i[L]=function(){return s.current||(s.current=Object.create(null),h.forceUpdateState()),T.apply(this,arguments)}},d=0,b=je;d<b.length;d++){var P=b[d];v(P)}return i},[]);Object.assign(m,g);var j=S.useCallback(function(i){s.current=i?p(p({},i),{fetchPolicy:i.fetchPolicy||y}):{fetchPolicy:y};var v=F(a.current,p({query:f.current},s.current)),d=h.executeQuery(p(p({},v),{skip:!1})).then(function(b){return Object.assign(b,g)});return d.catch(function(){}),d},[]);return[j,m]}const be=({cart:r,showMiniCart:t,setShowMiniCart:o,ref:s})=>e.jsx(n,{display:t?"block":"none",position:"absolute",backgroundColor:"#fff",right:"0",minWidth:"400px",border:"1px solid #ccc",onClick:()=>o(!t),ref:s,children:e.jsxs(R,{children:[e.jsx(n,{alignSelf:"start",margin:"1rem 0 0 1rem",textStyle:"StyledNav",children:r?e.jsxs(e.Fragment,{children:["Your Cart (",r.totalItem," items)"]}):e.jsx(e.Fragment,{children:"Your Cart (0) items"})}),e.jsx(A,{onClick:()=>o(!t),backgroundColor:"#ffffff",position:"absolute",top:"10px",right:"25px",children:e.jsx(re,{})}),e.jsx(n,{width:"100%",maxHeight:"400px",overflowX:"hidden",overflowY:"scroll",children:!r||r.totalItem===0?e.jsx(n,{margin:"0 0 0 1rem",children:"No Item in Cart"}):Object.values(r.data).map(a=>e.jsx(n,{display:"block",width:"100%",_hover:{backgroundColor:"#e9e9e9"},children:e.jsx(J,{to:`/order2/${a.strMeal}`,state:{strMeal:a.strMeal,strMealThumb:a.strMealThumb,id:a.idMeal},children:e.jsxs(R,{width:"100%",children:[e.jsxs(K,{width:"100%",children:[e.jsx(n,{width:"8rem",children:e.jsx(se,{src:a.strMealThumb,alt:a.strMeal,width:"80%",imgWidth:"100",auto:"webp",height:"100px",margin:"auto"})}),e.jsxs(R,{align:"start",children:[e.jsx(n,{textStyle:"StyledText",color:"#333333",children:a.strMeal}),e.jsxs(n,{textStyle:"StyledText",color:"#333333",children:[a.numMeal," x $",a.baseAmount]})]})]}),e.jsx(oe,{size:"lg",borderWidth:"1px",borderColor:"#e5e5e5"})]})})},a.idMeal))}),e.jsxs(n,{width:"100%",display:"flex",justifyContent:"space-around",paddingBottom:"1vh",children:[e.jsx(O,{to:"/cart",children:e.jsx(A,{sx:Z.textStyles.StyledButton.baseStyle,size:"md",children:"View Cart"})}),e.jsx(n,{alignSelf:"end",marginRight:"1rem",textStyle:"StyledNav",children:r?e.jsxs(e.Fragment,{children:["Total Price ($",r.totalAmount,")"]}):e.jsx(e.Fragment,{children:"Total Price ($0)"})})]})]})}),Ce=$`
query Cartitemnumber($email: String) {
  cartitemnumber(email: $email) {
    totalItem
  }
}
`,Se=$`
query Shoppingcarts($email: String) {
    shoppingcarts(email: $email) {
      totalItem
      data {
        strMealThumb
        strMeal
        numMeal
        baseAmount
      }
      totalAmount
    }
  }
`,D=async()=>await ce("meal-database",1,{upgrade(t){t.objectStoreNames.contains("cart")||t.createObjectStore("cart",{keyPath:"idMeal"})}}),Ye=({showcart:r=!0,...t})=>{const{cartItem:o,setCartItem:s,cartItemChangedRef:a}=u.useContext(te),{lname:f,email:l,availableAccessToken:x,accessToken:h,isUser:c}=Q(),{data:y,loading:m,error:g}=le(Ce,{variables:{email:l},fetchPolicy:"cache-and-network",skip:!l,onCompleted:C=>{s(C.cartitemnumber[0].totalItem)},onError:C=>{console.log(C)}}),[j,i]=u.useState(!1),[v,{data:d,loading:b,error:P}]=ve(Se,{fetchPolicy:"cache-and-network",skip:!l||!o||o<=0||!r}),[L,T]=u.useState(null),W=async()=>{if(!r)return;let M=await(await D()).get("cart","cartData");M&&T(M)};u.useEffect(()=>{c===!1&&r&&(async()=>{let E=await(await D()).get("cart","cartData");E&&s(E.totalItem)})()},[c,r]);const _=u.useRef();return z([_],()=>{i(!1)}),m?e.jsx(n,{children:e.jsx(w,{src:"/images/Basket.svg"})}):g?(console.error("CART_ITEM_QUERY error",g),e.jsx("p",{children:"Error!"})):e.jsx(e.Fragment,{children:r?e.jsxs(n,{position:"relative",onClick:()=>{i(!j),a.current&&(c?v({variables:{email:l}}):W(),a.current=!1)},ref:_,...t,children:[e.jsx(n,{position:"absolute",display:"inline-flex",right:"-0.5rem",top:"0.3rem",zIndex:"100",backgroundColor:"red",color:"white",borderRadius:"50%",height:"1rem",width:"1rem",alignItems:"center",justifyContent:"center",children:o}),e.jsx(n,{children:e.jsx(w,{src:"/images/Basket.svg"})}),j?e.jsx(be,{cart:c&&d&&d.shoppingcarts&&d.shoppingcarts.length>0?d.shoppingcarts[0]:L||null,showMiniCart:j,setShowMiniCart:i}):null]},"Cart"):e.jsx(O,{to:"/cart",children:e.jsxs(n,{position:"relative",...t,children:[e.jsx(n,{position:"absolute",display:"inline-flex",right:"-0.5rem",top:"0.3rem",zIndex:"100",backgroundColor:"red",color:"white",borderRadius:"50%",height:"1rem",width:"1rem",alignItems:"center",justifyContent:"center",children:o}),e.jsx(n,{children:e.jsx(w,{src:"/images/Basket.svg"})})]},"Cart")})})},Ve=()=>e.jsx(O,{to:"/like",children:e.jsx(ae,{icon:de,size:"2xl",color:"#ff0000"})}),We=()=>{const[r,t]=u.useState(!1),o=ue(),{lname:s,email:a,availableAccessToken:f,accessToken:l,isUser:x}=Q(),{modalOpen:h,setModalOpen:c}=u.useContext(H),y=async j=>{if(l)try{(await(await ee()).post("http://localhost:5000/logout/logout")).status===200&&(localStorage.removeItem("accessToken"),B.remove("X-CSRF-Token"),o({title:"Logged Out Successfully",status:"success",duration:2e3}),setTimeout(()=>{window.location.href="./"},2e3))}catch(i){i.response&&i.response.status===401?(localStorage.removeItem("accessToken"),B.remove("X-CSRF-Token"),console.log("Unauthorized - Logged Out")):i.response&&i.response.status===400?console.log(i.response):console.error("Error:",i)}},m=u.useRef();z([m],()=>{t(!1)});const{setModalState:g}=u.useContext(q);return f?e.jsxs(n,{height:"auto",position:"relative",ref:m,children:[e.jsxs(N,{textStyle:"StyledNav",onClick:()=>t(!r),children:["Hi ",s]}),e.jsx(n,{display:r?"block":"none",position:"absolute",backgroundColor:"#fff",right:"0",minWidth:"150px",height:"auto",border:"1px solid #ccc",onClick:()=>t(!r),children:e.jsx(I,{children:e.jsx(V,{onClick:y,children:e.jsx(n,{textStyle:"StyledNav",marginLeft:"1rem",children:"Log Out"})})})})]},"Login"):e.jsx(e.Fragment,{children:e.jsx(N,{textStyle:"StyledNav",onClick:()=>{c(!h),g("login")},children:"LOGIN"})})},Ge=()=>{const{modalState:r,setModalState:t}=u.useContext(q),{modalOpen:o,setModalOpen:s}=u.useContext(H);return e.jsx(N,{textStyle:"StyledNav",onClick:()=>{s(!o),t("reservation")},children:"RESERVATIONS"})};export{Ge as N,Ye as a,Ve as b,We as c};
