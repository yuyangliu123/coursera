import{f,o as N,j as e,a as g,p as V,B as n,r as c,V as $,S as F,H as A,L as Q}from"./index-BgPfMftx.js";import{u as Y,a as G}from"./JwtTokenRotate-Du0PIfFb.js";import{M as K}from"./ApolloContext-ovhTzdFd.js";import{S as W}from"./chunk-YJYDBQZ3-DQH71ZyI.js";import{g as J,b as X,o as Z}from"./index-vNCPerwW.js";import{b as ee}from"./chunk-DMO4EI7P-ffbJSNvT.js";import{c as ae}from"./index-CxF79Cv8.js";import{I as te}from"./chunk-QINAG4RG-CS9ezQ7p.js";import{B as M}from"./chunk-UVUR7MCU-XGr7ouz6.js";import{T as R}from"./chunk-2OOHT3W5-CJpRdX3-.js";import{I as se}from"./chunk-6CVSDS6C-qNJvPn8p.js";import"./index-VWaDGczM.js";import"./axios-B4uVmeYG.js";import"./chunk-2GBDXOMA-DT3Pegqs.js";import"./index-Bgli6ANI.js";import"./chunk-5PH6ULNP-DzDKoMfl.js";import"./chunk-R3DH46PF-iWUMGBws.js";var[re,T]=ae({name:"TableStylesContext",errorMessage:`useTableStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Table />" `}),B=f((s,o)=>{const r=ee("Table",s),{className:m,layout:E,...j}=N(s);return e.jsx(re,{value:r,children:e.jsx(g.table,{ref:o,__css:{tableLayout:E,...r.table},className:V("chakra-table",m),...j})})});B.displayName="Table";var H=f((s,o)=>{const r=T();return e.jsx(g.thead,{...s,ref:o,__css:r.thead})}),O=f((s,o)=>{const r=T();return e.jsx(g.tr,{...s,ref:o,__css:r.tr})}),le=f((s,o)=>{const r=T();return e.jsx(g.tbody,{...s,ref:o,__css:r.tbody})}),S=f(({isNumeric:s,...o},r)=>{const m=T();return e.jsx(g.td,{...o,ref:r,__css:m.td,"data-is-numeric":s})}),k=f(({isNumeric:s,...o},r)=>{const m=T();return e.jsx(g.th,{...o,ref:r,__css:m.th,"data-is-numeric":s})});const oe=({numItem:s})=>e.jsx(e.Fragment,{children:(()=>{switch(s){case 1:return e.jsxs(n,{textStyle:"StyledH2",color:"#000000",children:["Your Cart (",s," item)"]});default:return e.jsxs(n,{textStyle:"StyledH2",color:"#000000",children:["Your Cart (",s," items)"]})}})()}),ne=J`
    query CartPageformat($email: String) {
    cartpageformat(email: $email) {
        totalAmount
        totalItem
        data {
        strMeal
        numMeal
        idMeal
        baseAmount
        strMealThumb
        }
    }
    }
`,_=async()=>await Z("meal-database",1,{upgrade(o){o.objectStoreNames.contains("cart")||o.createObjectStore("cart",{keyPath:"idMeal"})}}),ie=async s=>{const r=(await _()).transaction("cart","readwrite");await r.objectStore("cart").put(s),await r.done},Te=()=>{const{email:s,availableAccessToken:o,isUser:r,accessToken:m}=Y(),{cartItem:E,setCartItem:j}=c.useContext(K),{data:y,loading:I,error:v}=X(ne,{variables:{email:s},fetchPolicy:"cache-and-network",skip:!s||!r}),[d,p]=c.useState(null),[U,L]=c.useState({}),[P,q]=c.useState({}),[u,w]=c.useState(0),C=(a,l)=>{const h=[...{...d}.data],b=h.findIndex(i=>i.strMeal===a.strMeal);if(b!==-1){const i={...h[b]},x=Object.fromEntries(Object.entries(i).filter(([D])=>["baseAmount","idMeal","numMeal"].includes(D)));x.numMeal=Number(l),q(D=>({...D,updatedMeal:x}))}},z=(a,l)=>{L(t=>({...t,[a.strMeal]:l}))};return c.useEffect(()=>{r&&r===!0?!I&&!v&&y&&y.cartpageformat&&y.cartpageformat.length>0?p(y.cartpageformat[0]):p(""):r===!1&&(async()=>{let t=await(await _()).get("cart","cartData");t&&p(t)})()},[I,v,y,r]),c.useEffect(()=>{if(d){const a={};d.data.forEach(l=>{a[l.strMeal]=l.numMeal}),L(a)}},[d]),c.useEffect(()=>{u&&(r?(async()=>{try{let l=await(await G()).post("http://localhost:5000/api/update",{event:"update",updatedItems:P.updatedMeal});l&&(l.data.status==="update"?(p(l.data.result),j(l.data.result.totalItem)):l.data.status==="delete"&&(j(0),p("")))}catch(l){console.error("Error:",l)}})():(async()=>{let t=await(await _()).get("cart","cartData");if(t){const h=P.updatedMeal;let b=t.data.find(i=>i.idMeal===h.idMeal);h.numMeal<=0?t.data=t.data.filter(i=>i.idMeal!==h.idMeal):(b.numMeal=h.numMeal,b.cartAmount=b.numMeal*b.baseAmount),t.totalAmount=t.data.reduce((i,x)=>i+x.cartAmount,0),t.totalAmount=parseFloat(t.totalAmount.toFixed(2)),t.totalItem=t.data.reduce((i,x)=>i+x.numMeal,0),p(t),j(t.totalItem)}await ie(Object.assign(t,{idMeal:"cartData"}))})())},[u]),I?e.jsx(n,{children:"Loading..."}):v?e.jsx(n,{children:"Error Occurred"}):!d||d.totalItem===0?e.jsx(n,{width:"100%",children:e.jsx(n,{textStyle:"StyledH2",color:"#000000",margin:"0 auto",width:"fit-content",children:"Your Cart is Empty"})}):e.jsxs($,{width:"100%",children:[e.jsx(oe,{numItem:d.totalItem}),e.jsxs(F,{direction:{xl:"row",base:"column"},width:"100%",alignItems:"flex-start",spacing:6,children:[e.jsx(n,{width:{xl:"75%",base:"100%"},children:e.jsxs(B,{display:{md:"table",base:"block"},width:"100%",children:[e.jsx(H,{display:{md:"table-header-group",base:"none"},children:e.jsxs(O,{children:[e.jsx(k,{colSpan:3,children:"Item"}),e.jsx(k,{children:"Price"}),e.jsx(k,{children:"Quantity"}),e.jsx(k,{children:"Total"})]})}),e.jsx(le,{display:{md:"table-row-group",base:"block"},children:d.data.map((a,l)=>e.jsxs(O,{borderBottomWidth:"1px",display:{md:"table-row",base:"grid"},gridTemplateAreas:{md:"none",sm:`
                                "img meal meal meal"
                                "img price quantity total"
                                `,base:`
                                    "img meal"
                                    "price price"
                                    "quantity quantity"
                                    "total total"
                                `},children:[e.jsx(S,{colSpan:1,gridArea:"img",display:{md:"table-cell",base:"block"},paddingLeft:"0",paddingRight:"0",borderBottomWidth:{md:"1px",base:"0"},children:e.jsx(n,{width:"8rem",children:e.jsx(te,{src:a.strMealThumb,width:"80%",margin:"auto"})})}),e.jsxs(S,{colSpan:2,gridArea:"meal",display:{md:"table-cell",base:"flex"},flexDirection:"row",borderBottomWidth:{md:"1px",base:"0"},alignItems:"center",paddingLeft:"0",paddingRight:"0",children:[e.jsx(n,{textStyle:"StyledText",color:"#333333",children:a.strMeal}),e.jsx(M,{backgroundColor:"#e5e5e5",borderRadius:"50%",size:"xs",onClick:async()=>{await C(a,0),await w(u+1)},display:{md:"none",base:"block"},marginLeft:"1rem",children:e.jsx(W,{color:"#757575"})})]}),e.jsxs(S,{gridArea:"price",display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},borderBottomWidth:{md:"1px",base:"0"},children:[e.jsx(R,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Price"}),e.jsxs(n,{children:["$",a.baseAmount]})]}),e.jsxs(S,{gridArea:"quantity",borderBottomWidth:{md:"1px",base:"0"},display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},children:[e.jsx(R,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Quantity"}),e.jsxs(A,{children:[e.jsx(M,{backgroundColor:"#e5e5e5",borderRadius:"50%",fontSize:"1.5rem",size:"md",onClick:async()=>{await C(a,a.numMeal-1),await w(u+1)},children:"-"}),e.jsx(se,{maxWidth:"8vh",width:"8vh",textAlign:"center",value:U[a.strMeal],onChange:t=>{z(a,t.target.value)},onBlur:async t=>{await C(a,Number(t.target.value)),await w(u+1)}}),e.jsx(M,{backgroundColor:"#e5e5e5",borderRadius:"50%",fontSize:"1.5rem",size:"md",onClick:async()=>{await C(a,a.numMeal+1),await w(u+1)},children:"+"})]})]}),e.jsxs(S,{gridArea:"total",display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},borderBottomWidth:{md:"1px",base:"0"},children:[e.jsx(R,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Total"}),e.jsxs(A,{justifyContent:{md:"right",base:"none"},children:[e.jsxs(n,{gridArea:"total",children:["$",parseFloat(a.baseAmount*a.numMeal).toFixed(2)]}),e.jsx(M,{backgroundColor:"#e5e5e5",borderRadius:"50%",size:"xs",onClick:async()=>{await C(a,0),await w(u+1)},gridArea:"delete",display:{md:"block",base:"none"},children:e.jsx(W,{color:"#757575"})})]})]})]},l))})]})}),e.jsxs(n,{width:{xl:"25%",md:"50%",base:"100%"},children:[e.jsx(B,{children:e.jsx(H,{children:e.jsx(k,{children:"Order Summary"})})}),e.jsxs(A,{justifyContent:"space-between",children:[e.jsx(n,{children:"Subtotal:"}),e.jsxs(n,{children:["$",d.totalAmount]})]}),e.jsxs(A,{justifyContent:"space-between",children:[e.jsx(n,{children:"Grand total:"}),e.jsxs(n,{children:["$",d.totalAmount]})]}),e.jsx(Q,{to:"/checkout/#deliver",children:e.jsx(M,{color:"#ffffff",backgroundColor:"#da1a32",border:"1px solid #da1a32",width:"100%",marginTop:"1vh",_hover:{color:"#da1a32",backgroundColor:"#ffffff"},children:"CHECKOUT"})})]})]})]})};export{Te as default};
